/*
    Can we assume that if we do not have a pricing for a product for a specific day, it was not listed that same day?
*/

SELECT "product"."id",
       "product"."coreProductId",
       "product"."basePrice",
       "product"."shelfPrice",
       "product"."promotedPrice",
       "product"."sourceType",
       "product"."retailerId",
       "product"."date",
       "product"."promotions",
       "product"."promotionDescription",
       "status"."id"         AS "status.id",
       "status"."productId"  AS "status.productId",
       "status"."status"     AS "status.status",
       "status"."screenshot" AS "status.screenshot",
       "status"."createdAt"  AS "status.createdAt",
       "status"."updatedAt"  AS "status.updatedAt"
FROM "products" AS "product"
         LEFT OUTER JOIN "productStatuses" AS "status" ON "product"."id" = "status"."productId"
WHERE "product"."coreProductId" IN
      (1754, 4064, 4298, 4299, 4300, 4304, 4331, 4364, 4372, 4373, 4377, 4483, 4572, 4657, 4691, 5015, 11317, 11564,
       11566, 11579, 14398, 16546, 16547, 16548, 16936, 19032, 20581, 20598, 21753, 21806, 22836, 24269, 24923, 26148,
       26155, 26349, 37606, 38006, 42148, 42763, 43008, 44825, 45525, 45750, 45912, 48006, 52635, 62359, 62361, 63173,
       63192, 64020, 69967, 82042, 82046, 120284, 120336, 240260, 240264, 277565, 311911, 317558, 317560, 317562,
       364807, 364818, 442818, 486859, 496581, 541845, 541846, 542649, 543683, 547213, 547214, 561431, 561432, 566211,
       641051, 729377, 729379, 731701, 737617, 737618, 737619, 739687, 739689, 739703, 739705, 739709, 765926, 780436,
       781601, 784964, 784965, 790677, 793114, 849813, 863968, 879773)
  AND "product"."dateId" IN
      (18628, 18661, 18694, 18727, 18760, 18793, 18826, 18859, 18892, 18925, 18958, 18991, 19024, 19057, 19090)
  AND "product"."retailerId" IN ('81', '1', '2', '3', '9', '11', '8', '10')
ORDER BY "product"."date";

/*
    productStatuses are not used in this query... can be safely removed.
*/
SELECT "product"."retailerId",
       "product"."dateId",
       AVG(REPLACE("shelfPrice", ',', '')::float) AS "average",
       BOOL_OR("promotions")                      AS "promotions"
FROM "products" AS "product"
         --LEFT OUTER JOIN "productStatuses" AS "status" ON "product"."id" = "status"."productId"
WHERE "shelfPrice" <> ''
  AND "product"."coreProductId" IN
      (1754, 4064, 4298, 4299, 4300, 4304, 4331, 4364, 4372, 4373, 4377, 4483, 4572, 4657, 4691, 5015, 11317, 11564,
       11566, 11579, 14398, 16546, 16547, 16548, 16936, 19032, 20581, 20598, 21753, 21806, 22836, 24269, 24923, 26148,
       26155, 26349, 37606, 38006, 42148, 42763, 43008, 44825, 45525, 45750, 45912, 48006, 52635, 62359, 62361, 63173,
       63192, 64020, 69967, 82042, 82046, 120284, 120336, 240260, 240264, 277565, 311911, 317558, 317560, 317562,
       364807, 364818, 442818, 486859, 496581, 541845, 541846, 542649, 543683, 547213, 547214, 561431, 561432, 566211,
       641051, 729377, 729379, 731701, 737617, 737618, 737619, 739687, 739689, 739703, 739705, 739709, 765926, 780436,
       781601, 784964, 784965, 790677, 793114, 849813, 863968, 879773)
  AND "product"."retailerId" IN ('81', '1', '2', '3', '9', '11', '8', '10')
  AND "product"."dateId" IN (16, 17)
  --AND product.date IN ('2023-12-03', '2023-12-04')
GROUP BY "retailerId", "dateId";

SELECT DISTINCT cp.id, cp.title
FROM "coreProducts" cp
         JOIN products p ON cp.id = p."coreProductId"

WHERE p."dateId" = 16
  AND "retailerId" IN ('81', '1', '2', '3', '9', '11', '8', '10')
  AND p."coreProductId" IN
      ('1754', '4064', '4298', '4299', '4300', '4304', '4331', '4364', '4372', '4373', '4377', '4483', '4572', '4657',
       '4691', '5015', '11317', '11564', '11566', '11579', '14398', '16546', '16547', '16548', '16936', '19032',
       '20084', '20581', '20598', '21753', '21806', '22836', '24269', '24923', '26148', '26155', '26349', '37606',
       '38006', '42148', '42763', '43008', '44825', '45525', '45750', '45912', '48006', '52635', '62359', '62361',
       '63173', '63192', '64020', '69967', '82042', '82046', '120284', '120336', '240260', '240264', '277565', '311911',
       '317558', '317560', '317562', '364807', '364818', '442818', '486859', '496581', '541845', '541846', '542649',
       '543683', '547213', '547214', '561431', '561432', '566211', '641051', '729377', '729379', '731701', '737617',
       '737618', '737619', '739687', '739689', '739703', '739705', '739709', '765926', '780436', '781601', '784964',
       '784965', '790677', '793114', '849813', '863968', '879772', '879773', '-1')

ORDER BY cp.id
